{
  "rules": {
    ".read": false,
    ".write": false,
    
    "products": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.admin == true || auth.token.superAdmin == true)",
      ".indexOn": ["sku", "category", "subcategory", "created_at", "updated_at"]
    },
    
    "clients": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || auth.token.admin == true || auth.token.superAdmin == true)",
        ".write": "auth != null && (auth.uid == $uid || auth.token.admin == true || auth.token.superAdmin == true)",
        ".validate": "newData.hasChildren(['company', 'email']) && newData.child('email').isString() && newData.child('email').val().matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/)"
      }
    },
    
    "quotes": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || auth.token.admin == true || auth.token.superAdmin == true)",
        ".write": "auth != null && (auth.uid == $uid || auth.token.admin == true || auth.token.superAdmin == true)",
        ".validate": "newData.hasChildren(['client_id', 'quote_number', 'total_amount']) && newData.child('total_amount').isNumber() && newData.child('total_amount').val() >= 0"
      }
    },
    
    "quote_items": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || auth.token.admin == true || auth.token.superAdmin == true)",
        ".write": "auth != null && (auth.uid == $uid || auth.token.admin == true || auth.token.superAdmin == true)"
      }
    },
    
    "cart_items": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid",
        ".validate": "newData.hasChildren(['product_id', 'quantity']) && newData.child('quantity').isNumber() && newData.child('quantity').val() > 0"
      }
    },
    
    "user_profiles": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || auth.token.admin == true || auth.token.superAdmin == true)",
        ".write": "auth != null && (auth.uid == $uid || (auth.token.superAdmin == true && $uid != auth.uid))",
        ".validate": "newData.hasChildren(['email', 'role']) && newData.child('role').val().matches(/^(admin|sales|distributor|superAdmin)$/)"
      }
    },
    
    "search_history": {
      ".read": "auth != null && (auth.token.admin == true || auth.token.superAdmin == true)",
      ".write": "auth != null",
      "$uid": {
        ".validate": "auth.uid == $uid"
      }
    },
    
    "app_settings": {
      ".read": "auth != null",
      ".write": "auth != null && auth.token.superAdmin == true",
      ".validate": "newData.hasChildren(['version', 'updated_at'])"
    },
    
    "audit_logs": {
      ".read": "auth != null && (auth.token.admin == true || auth.token.superAdmin == true)",
      ".write": "auth != null",
      "$logId": {
        ".validate": "newData.hasChildren(['user_id', 'action', 'timestamp']) && newData.child('user_id').val() == auth.uid"
      }
    },
    
    "rate_limits": {
      "$identifier": {
        ".read": "auth != null && auth.token.superAdmin == true",
        ".write": "auth != null && auth.token.superAdmin == true"
      }
    }
  }
}